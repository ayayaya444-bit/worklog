<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å·¥ä½œç´€éŒ„ Pro | v8.1 Cloud</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // 1. è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ Firebase Config
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyCCBQr7Wnf0fbSgi80gCG5_N6jvLKgTwe4",
            authDomain: "myworklogapp.firebaseapp.com",
            projectId: "myworklogapp",
            storage_bucket: "myworklogapp.firebasestorage.app",
            messagingSenderId: "124208437276",
            appId: "1:124208437276:web:4d8af62cf0c12beff8e7d9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // æš´éœ²çµ¦å…¨åŸŸèˆ‡åŸæœ¬çš„ Script äº’å‹•
        window.fbAuth = auth;
        window.fbDb = db;
        window.fbMethods = { signInWithEmailAndPassword, signOut, doc, getDoc, setDoc };

        // ç›£æ¸¬ç™»å…¥ç‹€æ…‹
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                syncFromCloud(user.uid);
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
            }
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        :root { --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom); --header-height: 72px; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: #f8fafc; min-height: 100vh; padding-top: calc(var(--header-height) + var(--safe-top)); }
        .fixed-header { position: fixed; top: 0; left: 0; right: 0; height: calc(var(--header-height) + var(--safe-top)); padding-top: var(--safe-top); background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(12px); z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding-left: 1.25rem; padding-right: 1.25rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .iphone-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-top: 1px solid rgba(0, 0, 0, 0.05); padding-bottom: var(--safe-bottom); z-index: 100; display: flex; height: calc(70px + var(--safe-bottom)); }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; color: #94a3b8; }
        .active-tab-btn { color: #2563eb !important; }
        input, select, textarea { font-size: 16px !important; border-radius: 0.75rem; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body class="pb-32">

    <div id="loginScreen" class="fixed inset-0 bg-slate-900 z-[9999] flex items-center justify-center p-6" style="display: none;">
        <div class="bg-white rounded-[2.5rem] w-full max-w-sm p-8 space-y-6 shadow-2xl">
            <div class="text-center">
                <h2 class="text-2xl font-black text-slate-800">é›²ç«¯åŒæ­¥ç™»å…¥</h2>
                <p class="text-xs font-bold text-slate-400 mt-1 uppercase tracking-widest">v8.1 Secure Access</p>
            </div>
            <div class="space-y-4">
                <input type="email" id="loginEmail" placeholder="Email" class="w-full bg-slate-50 p-4 rounded-2xl border-0 font-bold outline-none">
                <input type="password" id="loginPassword" placeholder="Password" class="w-full bg-slate-50 p-4 rounded-2xl border-0 font-bold outline-none">
                <button onclick="handleLogin()" id="loginBtn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-blue-700 transition-colors">Login</button>
            </div>
            <p id="loginError" class="text-center text-red-500 text-[10px] font-bold"></p>
        </div>
    </div>

    <nav class="fixed-header text-white">
        <div class="flex items-center gap-3">
            <button onclick="location.reload()" class="bg-slate-800 p-2.5 rounded-xl border border-white/5">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
            </button>
            <div><h1 class="text-md font-extrabold tracking-tight">ç´€éŒ„ç³»çµ±</h1><p class="text-[9px] font-bold text-blue-400 uppercase">Cloud Sync Active</p></div>
        </div>
        <div class="flex items-center gap-2">
            <button onclick="window.fbMethods.signOut(window.fbAuth)" class="text-[9px] font-black bg-white/10 px-2 py-1 rounded-lg">LOGOUT</button>
            <div class="bg-blue-600/20 border border-blue-500/30 px-3 py-1.5 rounded-2xl text-right">
                <p class="text-xl font-black font-mono text-white" id="navDayTotal">0.0</p>
            </div>
        </div>
    </nav>

    <div id="idManagerModal" class="modal-overlay"><div class="modal-card bg-white rounded-[2rem] w-full max-w-sm overflow-hidden flex flex-col max-h-[80vh]"><div class="p-6 border-b border-slate-100 flex justify-between items-center"><h2 class="text-xl font-black">ID ç®¡ç†ä¸­å¿ƒ</h2><button onclick="closeIdManager()" class="text-slate-400">âœ•</button></div><div id="idListScroll" class="flex-1 overflow-y-auto p-4 space-y-2 bg-slate-50"></div><div class="p-4"><button onclick="closeIdManager()" class="w-full bg-slate-900 text-white py-3 rounded-2xl font-black">Done</button></div></div></div>
    
    <div id="learningModal" class="modal-overlay"><div class="modal-card bg-white rounded-[2rem] p-6 space-y-4 w-full max-w-[320px] text-center"><h2 class="text-lg font-extrabold" id="modalTitle">æ–°ç™¼ç¾</h2><p class="text-xs text-slate-400" id="modalSubtitle">ID: ---</p><input type="text" id="modalInput" class="w-full bg-slate-50 p-4 text-center font-bold rounded-2xl border-0" placeholder="è¼¸å…¥åç¨±..."><button onclick="confirmLearning()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black uppercase">Confirm</button></div></div>

    <div class="p-4 max-w-md mx-auto">
        <div id="tab-form" class="tab-content active">
            <div id="topFrequency" class="mb-4 flex gap-2 overflow-x-auto pb-2"></div>
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-200">
                <div id="editBadge" class="hidden mb-4 bg-orange-50 text-orange-600 text-[10px] font-black px-3 py-2 rounded-xl border border-orange-100 flex justify-between items-center"><span>EDITING</span><button onclick="cancelEdit()" class="underline">CANCEL</button></div>
                <form id="timeForm" class="space-y-4">
                    <input type="hidden" id="editId">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1"><label class="px-1 text-[9px] font-black text-slate-400 uppercase">Client ID</label><input type="text" id="clientId" required class="w-full bg-slate-50 p-3 text-center text-sm font-bold border-0 uppercase" onblur="checkAndLearn('client'); autoFillCaseType(); updateMatterNameDisplay();"></div>
                        <div class="space-y-1"><label class="px-1 text-[9px] font-black text-slate-400 uppercase">Client Name</label><input type="text" id="clientName" class="w-full bg-slate-100 p-3 text-center text-sm text-slate-400 border-0" readonly></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1"><label class="px-1 text-[9px] font-black text-slate-400 uppercase">Case No.</label><input type="text" id="caseId" required class="w-full bg-slate-50 p-3 text-center text-sm font-bold border-0 uppercase" onblur="checkAndLearn('case'); autoFillCaseType(); updateMatterNameDisplay();"></div>
                        <div class="space-y-1"><label class="px-1 text-[9px] font-black text-slate-400 uppercase">Matter Name</label><input type="text" id="matterName" class="w-full bg-slate-100 p-3 text-center text-sm text-slate-400 border-0" readonly></div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-blue-50/50 p-3 rounded-[1.5rem] flex flex-col items-center"><input type="date" id="startDate" class="w-full bg-white p-2 text-xs font-bold text-center mb-1"><input type="time" id="startTime" class="w-full bg-white p-2 text-xs font-bold text-center"></div>
                        <div class="bg-indigo-50/50 p-3 rounded-[1.5rem] flex flex-col items-center"><input type="date" id="endDate" class="w-full bg-white p-2 text-xs font-bold text-center mb-1"><input type="time" id="endTime" class="w-full bg-white p-2 text-xs font-bold text-center"></div>
                    </div>
                    <input type="text" id="hours" readonly class="w-full bg-slate-900 text-blue-400 font-black rounded-2xl p-4 text-center text-3xl border-0" value="0.0">
                    <div class="grid grid-cols-2 gap-3">
                        <select id="workCode" class="w-full bg-slate-50 p-3 text-sm font-bold border-0"><option value="D">D</option><option value="RW">RW</option><option value="CF">CF</option><option value="RA">RA</option></select>
                        <select id="caseType" class="w-full bg-slate-50 p-3 text-sm font-bold border-0"><option value="M&A">M&A</option><option value="General Corporate">General Corporate</option><option value="Corporate Financing">Corporate Financing</option><option value="Project Financing">Project Financing</option><option value="Bond Issuance">Bond Issuance</option><option value="Formosa Bond">Formosa Bond</option><option value="é‡‘èå•†å“">é‡‘èå•†å“</option><option value="æŠ•ä¿¡æŠ•é¡§">æŠ•ä¿¡æŠ•é¡§</option><option value="PE Fund">PE Fund</option><option value="é‡‘èæ©Ÿæ§‹ä½µè³¼">é‡‘èæ©Ÿæ§‹ä½µè³¼</option><option value="å€‹äººè³‡æ–™ä¿è­·">å€‹äººè³‡æ–™ä¿è­·</option><option value="å…¶ä»–">å…¶ä»–</option></select>
                    </div>
                    <textarea id="content" rows="2" class="w-full bg-slate-50 p-3 text-sm font-medium border-0" placeholder="å…§å®¹èªªæ˜..."></textarea>
                    <button type="submit" id="submitBtn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase shadow-lg">Save & Sync</button>
                </form>
            </div>
        </div>

        <div id="tab-analysis" class="tab-content">
            <div class="space-y-4">
                <div class="bg-white p-5 rounded-[2rem] border border-slate-200 h-48"><canvas id="barChart"></canvas></div>
                <div class="bg-white p-5 rounded-[2rem] border border-slate-200 h-72"><canvas id="pieChart"></canvas></div>
                <div id="drillDownArea" class="hidden space-y-3"><h2 id="drillDownTitle" class="font-black px-2"></h2><div id="drillDownList" class="space-y-2"></div></div>
            </div>
        </div>

        <div id="tab-list" class="tab-content">
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-200 mb-4 space-y-3">
                <div class="grid grid-cols-2 gap-2"><input type="date" id="qStart" class="bg-slate-50 p-2 text-[10px] font-bold" onchange="updateUI()"><input type="date" id="qEnd" class="bg-slate-50 p-2 text-[10px] font-bold" onchange="updateUI()"></div>
                <div class="grid grid-cols-2 gap-2"><button onclick="updateUI()" class="bg-slate-900 text-white py-2 rounded-xl text-[10px] font-black uppercase">Filter</button><button onclick="exportLL()" class="bg-emerald-600 text-white py-2 rounded-xl text-[10px] font-black uppercase">Export CSV</button></div>
            </div>
            <div id="logContainer" class="space-y-3"></div>
        </div>
    </div>

    <div class="iphone-nav">
        <button onclick="switchTab('form')" id="btn-form" class="nav-btn active-tab-btn"><span class="text-[10px] font-black uppercase">New Log</span></button>
        <button onclick="switchTab('analysis')" id="btn-analysis" class="nav-btn"><span class="text-[10px] font-black uppercase">Analysis</span></button>
        <button onclick="switchTab('list')" id="btn-list" class="nav-btn"><span class="text-[10px] font-black uppercase">Vault</span></button>
    </div>

    <script>
        const DB_KEY = 'work_logs_final'; const META_KEY = 'meta_data_v4';
        let logs = JSON.parse(localStorage.getItem(DB_KEY) || '[]');
        let meta = JSON.parse(localStorage.getItem(META_KEY) || '{"clients":{}, "cases":{}}');
        let pChart, bChart, learningType = '';

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');
            btn.innerText = "Connecting...";
            try {
                await window.fbMethods.signInWithEmailAndPassword(window.fbAuth, email, pass);
            } catch (e) {
                document.getElementById('loginError').innerText = "ç™»å…¥å¤±æ•—ï¼š" + e.message;
                btn.innerText = "Login";
            }
        }

        async function syncFromCloud(uid) {
            try {
                const docRef = window.fbMethods.doc(window.fbDb, "users", uid);
                const docSnap = await window.fbMethods.getDoc(docRef);
                if (docSnap.exists()) {
                    const cloud = docSnap.data();
                    // å¦‚æœé›²ç«¯æœ‰è³‡æ–™ï¼Œä¸”é›²ç«¯æ¯”è¼ƒæ–°æˆ–æœ¬åœ°ç‚ºç©ºæ™‚åŒæ­¥
                    logs = cloud.logs || [];
                    meta = cloud.meta || {clients:{}, cases:{}};
                    localStorage.setItem(DB_KEY, JSON.stringify(logs));
                    localStorage.setItem(META_KEY, JSON.stringify(meta));
                }
                init();
            } catch (e) { console.error("Sync Error:", e); init(); }
        }

        async function saveToCloud() {
            const user = window.fbAuth.currentUser;
            if (user) {
                await window.fbMethods.setDoc(window.fbMethods.doc(window.fbDb, "users", user.uid), {
                    logs: logs,
                    meta: meta,
                    lastUpdated: new Date().toISOString()
                });
            }
        }

        function init() {
            const now = new Date(); const todayStr = now.toISOString().split('T')[0];
            document.getElementById('startDate').value = todayStr; document.getElementById('endDate').value = todayStr;
            updateUI();
        }

        function updateMatterNameDisplay() {
            const cId = document.getElementById('clientId').value.trim().toUpperCase();
            const csId = document.getElementById('caseId').value.trim().toUpperCase();
            document.getElementById('matterName').value = (meta.cases[cId] && meta.cases[cId][csId]) ? meta.cases[cId][csId] : (meta.cases[csId] || "");
        }

        function autoFillCaseType() {
            const cId = document.getElementById('clientId').value.trim();
            const csId = document.getElementById('caseId').value.trim();
            const lastLog = logs.find(l => l.c === cId && l.cn === csId);
            if (lastLog) document.getElementById('caseType').value = lastLog.ct;
        }

        document.getElementById('timeForm').onsubmit = async (e) => {
            e.preventDefault();
            const editId = document.getElementById('editId').value;
            const logData = {
                id: editId ? parseInt(editId) : Date.now(),
                sd: document.getElementById('startDate').value.replace(/-/g, '/'),
                ed: document.getElementById('endDate').value.replace(/-/g, '/'),
                s: document.getElementById('startTime').value,
                e: document.getElementById('endTime').value,
                h: parseFloat(document.getElementById('hours').value),
                c: document.getElementById('clientId').value.trim().toUpperCase(),
                cn: document.getElementById('caseId').value.trim().toUpperCase(),
                wc: document.getElementById('workCode').value,
                ct: document.getElementById('caseType').value,
                desc: document.getElementById('content').value.trim()
            };
            if (editId) { const idx = logs.findIndex(l => l.id == editId); logs[idx] = logData; }
            else { logs.unshift(logData); }
            
            localStorage.setItem(DB_KEY, JSON.stringify(logs));
            await saveToCloud(); // åŒæ­¥åˆ°é›²ç«¯
            location.reload();
        };

        function calc() {
            const d1 = document.getElementById('startDate').value, t1 = document.getElementById('startTime').value,
                  d2 = document.getElementById('endDate').value, t2 = document.getElementById('endTime').value;
            if(d1 && t1 && d2 && t2) {
                const diff = (new Date(`${d2}T${t2}`) - new Date(`${d1}T${t1}`)) / 60000;
                document.getElementById('hours').value = diff >= 0 ? (Math.ceil(diff / 6) / 10).toFixed(1) : "0.0";
            }
        }
        ['startDate', 'startTime', 'endDate', 'endTime'].forEach(id => document.getElementById(id).onchange = calc);

        function checkAndLearn(type) {
            const cId = document.getElementById('clientId').value.trim().toUpperCase();
            const idVal = document.getElementById(type === 'client' ? 'clientId' : 'caseId').value.trim().toUpperCase();
            if (!idVal) return;
            if (type === 'client' && meta.clients[idVal]) { document.getElementById('clientName').value = meta.clients[idVal]; return; }
            if (type === 'case') {
                if (!cId) return;
                if (meta.cases[cId] && meta.cases[cId][idVal]) { updateMatterNameDisplay(); return; }
            }
            learningType = type;
            document.getElementById('modalTitle').innerText = `å­¸ç¿’æ–° ${type.toUpperCase()}`;
            document.getElementById('modalSubtitle').innerText = `ID: ${idVal}`;
            document.getElementById('learningModal').style.display = 'flex';
        }

        async function confirmLearning() {
            const name = document.getElementById('modalInput').value.trim();
            const cId = document.getElementById('clientId').value.trim().toUpperCase();
            const csId = document.getElementById('caseId').value.trim().toUpperCase();
            if (name) {
                if (learningType === 'client') meta.clients[cId] = name;
                else { if (!meta.cases[cId]) meta.cases[cId] = {}; meta.cases[cId][csId] = name; }
                localStorage.setItem(META_KEY, JSON.stringify(meta));
                await saveToCloud();
                updateMatterNameDisplay();
                document.getElementById('clientName').value = meta.clients[cId] || "";
            }
            document.getElementById('learningModal').style.display = 'none';
        }

        function updateUI() {
            const now = new Date(); const todaySlash = `${now.getFullYear()}/${String(now.getMonth()+1).padStart(2,'0')}/${String(now.getDate()).padStart(2,'0')}`;
            document.getElementById('navDayTotal').innerText = logs.filter(l => l.sd === todaySlash).reduce((s, c) => s + c.h, 0).toFixed(1);
            
            const container = document.getElementById('logContainer');
            const qs = document.getElementById('qStart').value.replace(/-/g, '/'), qe = document.getElementById('qEnd').value.replace(/-/g, '/');
            const filtered = logs.filter(l => (!qs || l.sd >= qs) && (!qe || l.sd <= qe)).sort((a,b) => b.sd.localeCompare(a.sd) || b.s.localeCompare(a.s));
            
            container.innerHTML = filtered.map(l => `
                <div class="bg-white rounded-2xl p-4 border border-slate-100 shadow-sm relative">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-[9px] font-black text-blue-600 mb-1">${l.sd} ${l.s}-${l.e}</p>
                            <h3 class="font-bold text-xs">${l.c} | ${l.cn}</h3>
                            <p class="text-[10px] text-slate-400 font-bold">${(meta.cases[l.c] && meta.cases[l.c][l.cn]) ? meta.cases[l.c][l.cn] : '---'}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-mono font-black">${l.h.toFixed(1)}</p>
                            <div class="flex gap-2 mt-2">
                                <button onclick="startEdit(${l.id})" class="text-blue-500 text-[10px] font-bold">EDIT</button>
                                <button onclick="deleteLog(${l.id})" class="text-red-400 text-[10px] font-bold">DEL</button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            renderTopThree();
        }

        function renderTopThree() {
            const freq = {}; logs.slice(0, 30).forEach(l => { const k = `${l.c}|${l.cn}`; freq[k] = (freq[k]||0)+1; });
            const top = Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,3);
            document.getElementById('topFrequency').innerHTML = top.map(([k]) => `<div onclick="applyQuick('${k.split('|')[0]}','${k.split('|')[1]}')" class="bg-blue-600 text-white text-[9px] px-3 py-2 rounded-full font-black whitespace-nowrap">ğŸ”¥ ${k.split('|')[1]}</div>`).join('');
        }

        function applyQuick(c, m) { document.getElementById('clientId').value = c; document.getElementById('caseId').value = m; updateMatterNameDisplay(); autoFillCaseType(); calc(); }
        function startEdit(id) { const l = logs.find(x => x.id === id); if(!l) return; switchTab('form'); document.getElementById('editId').value=l.id; document.getElementById('clientId').value=l.c; document.getElementById('caseId').value=l.cn; document.getElementById('startDate').value=l.sd.replace(/\//g,'-'); document.getElementById('startTime').value=l.s; document.getElementById('endDate').value=l.ed.replace(/\//g,'-'); document.getElementById('endTime').value=l.e; document.getElementById('content').value=l.desc; document.getElementById('hours').value=l.h; updateMatterNameDisplay(); document.getElementById('editBadge').classList.remove('hidden'); }
        async function deleteLog(id) { if(confirm("Delete?")) { logs = logs.filter(l => l.id !== id); localStorage.setItem(DB_KEY, JSON.stringify(logs)); await saveToCloud(); updateUI(); } }
        function switchTab(t) { document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active')); document.getElementById('tab-' + t).classList.add('active'); if(t==='analysis') renderCharts(); }
        function closeIdManager() { document.getElementById('idManagerModal').style.display='none'; }
        
        function renderCharts() {
            if (pChart) pChart.destroy(); if (bChart) bChart.destroy();
            const catMap = {}; logs.forEach(l => { if (l.c === 'L00640') return; if(!catMap[l.ct]) catMap[l.ct] = new Set(); catMap[l.ct].add(l.c+l.cn); });
            pChart = new Chart(document.getElementById('pieChart').getContext('2d'), { type: 'doughnut', data: { labels: Object.keys(catMap), datasets: [{ data: Object.values(catMap).map(s=>s.size), backgroundColor: ['#3b82f6','#6366f1','#10b981','#f59e0b','#ef4444'] }] }, options: { maintainAspectRatio: false } });
        }

        function exportLL() {
            let csv = "\uFEFFInitial,Date,Client,Case,Hours,Code,Desc\n";
            logs.forEach(l => { csv += `CYE,${l.sd.replace(/\//g,'')},${l.c},${l.cn},${l.h},${l.wc},"${l.desc}"\n`; });
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement("a"); link.href = URL.createObjectURL(blob); link.download = "log.csv"; link.click();
        }
    </script>
</body>
</html>
